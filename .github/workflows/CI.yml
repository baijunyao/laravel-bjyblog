name: CI

on: [push, pull_request]

jobs:
  dotenv_lint:
    name: Dotenv Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Initial
        run: |
          ls -al
          sudo chown -R $USER:$USER *
          sudo chmod -R 777 storage
          ls -al
          ls -al storage/clockwork
          cp .env.docker .env
          docker compose -f docker-compose-actions.yml up -d
          sudo echo "127.0.0.1 laravel-bjyblog.test" | sudo tee -a /etc/hosts
          sudo cat /etc/hosts
          docker compose exec -T php /usr/local/bin/composer install
          docker compose exec -T php /usr/local/bin/php artisan key:generate --force
          docker compose exec -T php /usr/local/bin/php artisan passport:keys --force
          docker compose exec -T php /usr/local/bin/php artisan migrate
          docker compose exec -T php /usr/local/bin/php artisan db:seed
          curl laravel-bjyblog.test
          yarn install
          yarn cypress
